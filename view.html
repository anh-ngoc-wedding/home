<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem thông tin khảo sát</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getFirestore, getDocs, collection } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDERyLd2-jqVn3TV_V2lvppDYomVpmh9ZI",
            authDomain: "anh-ngoc-mary.firebaseapp.com",
            projectId: "anh-ngoc-mary",
            storageBucket: "anh-ngoc-mary.firebasestorage.app",
            messagingSenderId: "734051089785",
            appId: "1:734051089785:web:e89457d3e47be8104b43a8",
            measurementId: "G-2XRF66RPP7",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let ascendingData = {}
        let tableData = [];
        const tableBody = document.getElementById("dataTable").getElementsByTagName("tbody")[0];

        async function fetchData() {
            const querySnapshot = await getDocs(collection(db, "khaosat"));
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const row = tableBody.insertRow();

                const ten = row.insertCell();
                ten.textContent = data.ten;

                const sdt = row.insertCell();
                sdt.textContent = data.sdt;

                const thamGia = row.insertCell();
                thamGia.textContent = data.thamGia;

                const loichuc = row.insertCell();
                loichuc.textContent = data.loichuc;

                tableData.push(data)
            });
        }

        fetchData();

        // Hàm sắp xếp và cập nhật bảng
        function sortTable(field) {
            if(ascendingData[field] === undefined) {
                ascendingData[field] = true
            } else {
                ascendingData[field] = !ascendingData[field]
            }
            // Sắp xếp dữ liệu theo trường và thứ tự
            tableData.sort((a, b) => {
                return ascendingData[field] ? a[field].localeCompare(b[field])
                 : b[field].localeCompare(a[field])

            });

            // Cập nhật lại bảng sau khi sắp xếp
            const tableBody = document.getElementById("dataTable").getElementsByTagName("tbody")[0];
            tableBody.innerHTML = '';

            tableData.forEach(item => {
                const data = item;
                const row = tableBody.insertRow();

                const ten = row.insertCell();
                ten.textContent = data.ten;

                const sdt = row.insertCell();
                sdt.textContent = data.sdt;

                const thamGia = row.insertCell();
                thamGia.textContent = data.thamGia;

                const loichuc = row.insertCell();
                loichuc.textContent = data.loichuc;
            });
        }

        // Thêm các sự kiện sắp xếp khi nhấn vào các nút
        document.getElementById("ten").addEventListener("click", () => {
            sortTable('ten');
        });

        document.getElementById("sdt").addEventListener("click", () => {
            sortTable('sdt');
        });

        document.getElementById("thamGia").addEventListener("click", () => {
            sortTable('thamGia');
        });

    </script>
</head>
<style>
    body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f4f4f9;
}

.container {
  width: 90%;
  margin: 20px auto;
  text-align: center;
}

h1 {
  color: #333;
}

/* Bao bọc bảng trong một container có khả năng cuộn ngang */
.table-wrapper {
  width: 100%;
  overflow-x: auto;  /* Cho phép cuộn ngang */
  -webkit-overflow-scrolling: touch; /* Cải thiện trải nghiệm cuộn trên thiết bị di động */
}

/* Định dạng bảng */
table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 12px 15px;
  text-align: left;
  border: 1px solid #ddd;
}

th {
  background-color: #4CAF50;
  color: white;
}

tr:hover {
  background-color: #f1f1f1;
}

@media screen and (max-width: 600px) {
  table {
    width: 600px; /* Đảm bảo bảng không quá rộng trên màn hình nhỏ */
  }
}
</style>

<body>
    <div class="container">
        <h1>Xem thông tin khảo sát</h1>
        <div class="table-wrapper">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th id="ten" style="width: 100px;">Tên</th>
                        <th id="sdt" style="width: 100px;">Số điện thoại</th>
                        <th id="thamGia" style="width: 50px;">Tham gia</th>
                        <th>Lời nhắn</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dữ liệu từ Firestore sẽ được thêm vào đây -->
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>